var y=Object.defineProperty;var L=(l,e,t)=>e in l?y(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var i=(l,e,t)=>(L(l,typeof e!="symbol"?e+"":e,t),t);let f=0;const S=(l,e)=>(...t)=>{clearTimeout(f),f=setTimeout(()=>l(...t),e)};let u=null,w=0;const b=(l,e)=>(...t)=>{u===null?(l(...t),u=Date.now()):(clearTimeout(w),w=setTimeout(()=>{Date.now()-u>=e&&(l(...t),u=Date.now())},e-(Date.now()-u)))};class v{constructor(e,t){i(this,"rootEl");i(this,"multiple");i(this,"fetchUrl",null);i(this,"fetchAbortController",null);i(this,"dropdown");i(this,"dropdownOptions",new Map);i(this,"optionsSearchText",new Map);i(this,"dropdownSearch");i(this,"dropdownSelectAllBtn",null);i(this,"dropdownUnselectAllBtn",null);i(this,"uiBox");i(this,"placeholder");i(this,"valueLabel");i(this,"select");i(this,"current");i(this,"active",null);i(this,"isOpen",!1);i(this,"calcCurrent",()=>this.multiple?Array.from(this.select.selectedOptions).map(e=>e.value):this.select.value);i(this,"init",()=>{var e,t,n,o;this.populateDropdown();for(const[s,r]of this.dropdownOptions)r.addEventListener("mousemove",b(c=>s!==this.active?this.setActive(s):null,25));this.uiBox.addEventListener("click",()=>this.toggle()),document.addEventListener("click",s=>{this.rootEl.contains(s.target)||this.close(!1)}),document.addEventListener("keyup",s=>{s.key==="Escape"&&this.close(!1)}),document.addEventListener("keydown",s=>{s.key===" "&&this.uiBox===document.activeElement&&this.toggle(),this.isOpen&&this.active!==null&&s.key==="Enter"&&this.onOptionSelected(this.active),this.isOpen&&this.active!==null&&s.key==="ArrowDown"&&this.moveActiveDown(),this.isOpen&&this.active!==null&&s.key==="ArrowUp"&&this.moveActiveUp()}),(e=this.dropdownSearch)==null||e.addEventListener("input",S(s=>{this.search(),this.fetchOptions()},250)),(t=this.dropdownSearch)==null||t.addEventListener("keydown",s=>{s.key==="Enter"&&s.preventDefault()}),this.dropdown.addEventListener("click",s=>{const r=s.target;if(r.classList.contains("ss-remove-icon")){this.onOptionSelected(this.emptyValue);return}const c=r.closest(".ss-option");c!==null&&this.onOptionSelected(c.getAttribute("data-key"))}),this.select.addEventListener("change",this.update),(n=this.dropdownSelectAllBtn)==null||n.addEventListener("click",s=>this.setAll(!0)),(o=this.dropdownUnselectAllBtn)==null||o.addEventListener("click",s=>this.setAll(!1)),this.update(),this.initLivewire(),this.fetchOptions()});i(this,"initLivewire",()=>{if(!this.rootEl.hasAttribute("data-livewire")){window.Livewire&&console.info("[SearchSelect] Be sure to include the livewire attribute when rendering inside a Livewire component");return}if(!window.Livewire){console.error("MISSING LIVEWIRE GLOBAL OBJECT!");return}window.Livewire.hook("morph.updated",({el:t})=>this.onLivewireUpdate(t)),window.Livewire.hook("element.init",({el:t})=>setTimeout(()=>this.onLivewireUpdate(t),50))});i(this,"open",()=>{this.isOpen=!0,this.dropdown.classList.remove("hidden"),setTimeout(()=>{var e;return(e=this.dropdownSearch)==null?void 0:e.focus()},25),this.setActive(this.dropdownOptions.keys().next().value??null)});i(this,"close",(e=!0)=>{this.isOpen=!1,this.dropdown.classList.add("hidden"),e&&this.uiBox.focus()});i(this,"toggle",()=>{this.isOpen?this.close():this.open()});i(this,"fetchOptions",async()=>{var o;if(!this.fetchUrl)return;this.fetchAbortController&&this.fetchAbortController.abort(),this.fetchAbortController=new AbortController;const e=this.fetchAbortController.signal;let t=new URL(this.fetchUrl,window.location.origin);const n=(o=this.dropdownSearch)==null?void 0:o.value.trim();n&&t.searchParams.append("q",n),this.dropdown.classList.add("loading");try{const s=await fetch(t.toString(),{signal:e});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const r=await s.json(),c=this.emptyValue,p=new Map;for(const a of this.select.options)a.value!==c&&a.selected&&p.set(a.value,a.innerText);if(this.select.innerHTML="",!this.multiple){const a=document.createElement("option");a.value=c,this.select.appendChild(a)}for(const a in r){const h=a.toString(),d=document.createElement("option");d.value=h,d.innerText=r[h],p.has(h)&&(d.selected=!0,p.delete(h)),this.select.appendChild(d)}for(const[a,h]of p){const d=document.createElement("option");d.value=a,d.innerText=h,d.selected=!0,d.setAttribute("data-hidden","true"),this.select.appendChild(d)}this.populateDropdown(),this.update()}catch(s){console.error("[SearchSelect] Error fetching options:",s)}finally{this.dropdown.classList.remove("loading"),this.fetchAbortController=null}});i(this,"search",()=>{var s;if(!this.dropdownSearch||this.fetchUrl!==null)return;let e=this.dropdownSearch.value.toLowerCase().trim();e.length<2&&(e="");let t=null;const n=[],o=[];for(const[r,c]of this.dropdownOptions)e===""||((s=this.optionsSearchText.get(r))==null?void 0:s.includes(e))?(c.classList.contains("hidden")&&n.push(c),t===null&&(t=r)):c.classList.contains("hidden")||o.push(c);requestAnimationFrame(()=>{n.forEach(r=>r.classList.remove("hidden")),o.forEach(r=>r.classList.add("hidden")),this.setActive(t)})});i(this,"populateDropdown",()=>{const e=new Set(this.dropdownOptions.keys()),t=this.rootEl.querySelector(".ss-option-template"),n=this.dropdown.querySelector(".ss-options");for(const o of this.select.options){if(o.value===this.emptyValue)continue;if(this.dropdownOptions.has(o.value)){e.delete(o.value);const r=this.dropdownOptions.get(o.value);r.querySelector("span").innerText=o.innerText,o.hasAttribute("data-hidden")?r.classList.add("hidden"):r.classList.remove("hidden");continue}const s=t.content.cloneNode(!0).firstElementChild;s.setAttribute("data-key",o.value),s.querySelector("span").innerText=o.label,o.hasAttribute("data-hidden")?s.classList.add("hidden"):s.classList.remove("hidden"),n.appendChild(s),this.dropdownOptions.set(o.value,s),this.optionsSearchText.set(o.value,o.label.toLowerCase())}e.forEach(o=>{var s;(s=this.dropdownOptions.get(o))==null||s.remove(),this.dropdownOptions.delete(o),this.optionsSearchText.delete(o)})});i(this,"onOptionSelected",e=>{if(e==null&&(e=this.emptyValue),this.multiple){for(const t of this.select.options)if(t.value===e){t.selected=!t.selected;break}}else this.select.value=e;this.select.dispatchEvent(new Event("change")),this.multiple||this.close()});i(this,"setAll",e=>{var t;for(const n of this.select.options){const o=n.value.trim();n.selected=(t=this.dropdownOptions.get(o))!=null&&t.classList.contains("hidden")?n.selected:e}this.select.dispatchEvent(new Event("change"))});i(this,"setActive",e=>{var t,n,o;e!==this.active&&(this.active!==null&&((t=this.dropdownOptions.get(this.active))==null||t.classList.remove("active")),e!==null&&((n=this.dropdownOptions.get(e))==null||n.classList.add("active"),(o=this.dropdownOptions.get(e))==null||o.scrollIntoView({block:"nearest",behavior:"smooth"})),this.active=e)});i(this,"moveActiveDown",()=>{let e=!1;for(const t of this.dropdownOptions.keys()){if(e){this.setActive(t);break}t===this.active&&(e=!0)}});i(this,"moveActiveUp",()=>{let e=null;for(const t of this.dropdownOptions.keys()){if(t===this.active){e&&this.setActive(e);break}e=t}});i(this,"update",()=>{this.multiple?this.updateMultiple():this.updateSingle()});i(this,"updateMultiple",()=>{this.current=this.calcCurrent();const e=[];for(const[t,n]of this.dropdownOptions)this.current.includes(t)?(n.classList.add("selected"),e.push(n.innerText.trim())):n.classList.remove("selected");e.length>0?(this.valueLabel.innerHTML=e.join(", "),this.valueLabel.style.display="block",this.placeholder.style.display="none"):(this.placeholder.style.display="block",this.valueLabel.style.display="none")});i(this,"updateSingle",()=>{this.current=this.calcCurrent(),this.dropdown.querySelectorAll(".ss-option.selected").forEach(t=>t.classList.remove("selected"));let e="";if(this.current!==this.emptyValue){const t=this.dropdownOptions.get(this.current);t&&(t.classList.add("selected"),e=t.innerText??"")}e!==""?(this.valueLabel.innerHTML=e,this.valueLabel.style.display="block",this.placeholder.style.display="none"):(this.placeholder.style.display="block",this.valueLabel.style.display="none")});this.multiple=t,this.fetchUrl=e.getAttribute("data-fetchurl"),this.rootEl=e,this.dropdown=e.querySelector(".ss-dropdown"),this.dropdownSearch=this.dropdown.querySelector(".ss-dropdown-search input"),this.dropdownSelectAllBtn=this.dropdown.querySelector(".ss-dropdown-search .ss-select-all"),this.dropdownUnselectAllBtn=this.dropdown.querySelector(".ss-dropdown-search .ss-unselect-all"),this.uiBox=e.querySelector(".ss-box"),this.placeholder=this.uiBox.querySelector(".ss-placeholder"),this.valueLabel=this.uiBox.querySelector(".ss-value-label"),this.select=e.querySelector(".ss-ghost-select"),this.current=this.calcCurrent(),this.init()}get emptyValue(){return this.multiple?"":this.select.firstElementChild.value}onLivewireUpdate(e){e===this.select&&(JSON.stringify(this.current)!==JSON.stringify(this.calcCurrent())&&this.update(),setTimeout(()=>this.populateDropdown(),50))}}class O extends v{constructor(e){super(e,!1)}}class A extends v{constructor(e){super(e,!0)}}const m=l=>{l.querySelectorAll("div.ss-wrapper").forEach(e=>new O(e)),l.querySelectorAll("div.ms-wrapper").forEach(e=>new A(e))};m(document);const E=new MutationObserver(function(l){l.forEach(function(e){e.addedNodes.forEach(function(t){t.nodeType===1&&m(t)})})});E.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1});
