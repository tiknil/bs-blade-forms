var L=Object.defineProperty;var y=(l,e,t)=>e in l?L(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var s=(l,e,t)=>(y(l,typeof e!="symbol"?e+"":e,t),t);let w=0;const m=(l,e)=>(...t)=>{clearTimeout(w),w=setTimeout(()=>l(...t),e)};let p=null,v=0;const E=(l,e)=>(...t)=>{p===null?(l(...t),p=Date.now()):(clearTimeout(v),v=setTimeout(()=>{Date.now()-p>=e&&(l(...t),p=Date.now())},e-(Date.now()-p)))},u="ac:custom-value";class f{constructor(e,t,i){s(this,"rootEl");s(this,"multiple");s(this,"allowCustom",!1);s(this,"fetchUrl",null);s(this,"fetchAbortController",null);s(this,"dropdown");s(this,"dropdownOptions",new Map);s(this,"optionsSearchText",new Map);s(this,"dropdownOptionsWrapper");s(this,"template");s(this,"dropdownSearch");s(this,"dropdownSelectAllBtn",null);s(this,"dropdownUnselectAllBtn",null);s(this,"uiBox");s(this,"placeholder");s(this,"valueLabel");s(this,"select");s(this,"current");s(this,"active",null);s(this,"isOpen",!1);s(this,"calcCurrent",()=>this.multiple?Array.from(this.select.selectedOptions).map(e=>e.value):this.select.value);s(this,"init",()=>{var e,t,i,n,r;this.populateDropdown(),(e=this.uiBox)==null||e.addEventListener("click",()=>this.toggle()),document.addEventListener("click",o=>{this.rootEl.contains(o.target)||this.close(!1)}),document.addEventListener("keyup",o=>{o.key==="Escape"&&this.close(!1)}),document.addEventListener("keydown",o=>{o.key===" "&&this.uiBox===document.activeElement&&this.toggle(),this.isOpen&&this.active!==null&&o.key==="Enter"&&this.onOptionSelected(this.active),this.isOpen&&this.active!==null&&o.key==="ArrowDown"&&this.moveActiveDown(),this.isOpen&&this.active!==null&&o.key==="ArrowUp"&&this.moveActiveUp()}),(t=this.dropdownSearch)==null||t.addEventListener("input",m(o=>{this.search(),this.fetchOptions()},250)),(i=this.dropdownSearch)==null||i.addEventListener("keydown",o=>{o.key==="Enter"&&o.preventDefault()}),this.dropdown.addEventListener("click",o=>{const a=o.target;if(a.classList.contains("ss-remove-icon")){this.onOptionSelected(this.emptyValue);return}const c=a.closest(".ss-option");c!==null&&this.onOptionSelected(c.getAttribute("data-key"))}),this.select.addEventListener("change",this.update),(n=this.dropdownSelectAllBtn)==null||n.addEventListener("click",o=>this.setAll(!0)),(r=this.dropdownUnselectAllBtn)==null||r.addEventListener("click",o=>this.setAll(!1)),this.update(),this.initLivewire(),this.fetchOptions()});s(this,"initLivewire",()=>{if(!this.rootEl.hasAttribute("data-livewire")){window.Livewire&&console.info("[SearchSelect] Be sure to include the livewire attribute when rendering inside a Livewire component");return}if(!window.Livewire){console.error("MISSING LIVEWIRE GLOBAL OBJECT!");return}window.Livewire.hook("morph.updated",({el:t})=>this.onLivewireUpdate(t)),window.Livewire.hook("element.init",({el:t})=>setTimeout(()=>this.onLivewireUpdate(t),50))});s(this,"open",()=>{this.isOpen=!0,this.dropdown.classList.remove("hidden"),this.setActive(this.dropdownOptions.keys().next().value??null),this.onOpen()});s(this,"onOpen",()=>{setTimeout(()=>{var e;return(e=this.dropdownSearch)==null?void 0:e.focus()},25)});s(this,"close",(e=!0)=>{var t;this.isOpen=!1,this.dropdown.classList.add("hidden"),e&&((t=this.uiBox)==null||t.focus()),this.onClose()});s(this,"onClose",()=>{});s(this,"toggle",()=>{this.isOpen?this.close():this.open()});s(this,"fetchOptions",async()=>{if(!this.fetchUrl)return;this.fetchAbortController&&this.fetchAbortController.abort(),this.fetchAbortController=new AbortController;const e=this.fetchAbortController.signal;let t=new URL(this.fetchUrl,window.location.origin);const i=this.searched.trim();i&&t.searchParams.append("q",i),this.dropdown.classList.add("loading");try{const n=await fetch(t.toString(),{signal:e});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);const r=await n.json(),o=this.emptyValue,a=new Map;for(const c of this.select.options)c.value!==o&&c.selected&&a.set(c.value,c.innerText);if(this.select.innerHTML="",!this.multiple){const c=document.createElement("option");c.value=o,this.select.appendChild(c)}for(const c in r){const d=c.toString(),h=document.createElement("option");h.value=d,h.innerText=r[d],a.has(d)&&(h.selected=!0,a.delete(d)),this.select.appendChild(h)}for(const[c,d]of a){const h=document.createElement("option");h.value=c,h.innerText=d,h.selected=!0,h.setAttribute("data-hidden","true"),this.select.appendChild(h)}this.populateDropdown()}catch(n){console.error("[SearchSelect] Error fetching options:",n)}finally{this.dropdown.classList.remove("loading"),this.fetchAbortController=null}});s(this,"search",()=>{var n;if(this.fetchUrl!==null)return;let e=this.searched.toLowerCase().trim();e.length<2&&(e="");let t=null;const i=[];for(const[r,o]of this.dropdownOptions)r===u&&(o.querySelector("span").innerText=this.searched),(r===u||e===""||((n=this.optionsSearchText.get(r))==null?void 0:n.includes(e)))&&(i.push(o),t===null&&(t=r));requestAnimationFrame(()=>{const r=this.dropdownOptionsWrapper,o=document.createDocumentFragment();i.forEach(a=>{o.appendChild(a)}),r.replaceChildren(o),this.setActive(t)})});s(this,"populateDropdown",()=>{const e=new Set(this.dropdownOptions.keys());for(const t of this.select.options)t.value!==this.emptyValue&&(e.delete(t.value),this.updateDropdownOption(this.dropdownOptions.get(t.value)??null,t.value,t.label,t.hasAttribute("data-hidden")));this.allowCustom&&(e.delete(u),this.updateDropdownOption(this.dropdownOptions.get(u)??null,u,this.searched,!1)),e.forEach(t=>{var i;(i=this.dropdownOptions.get(t))==null||i.remove(),this.dropdownOptions.delete(t),this.optionsSearchText.delete(t)})});s(this,"updateDropdownOption",(e,t,i,n)=>{const r=e===null;return e===null&&(e=this.template.content.cloneNode(!0).firstElementChild),e.setAttribute("data-key",t),e.querySelector("span").innerText=i,n?e.classList.add("hidden"):e.classList.remove("hidden"),r&&(this.dropdownOptionsWrapper.appendChild(e),this.onDropdownOptionCreated(e,t),this.dropdownOptions.set(t,e),this.optionsSearchText.set(t,i.toLowerCase())),e});s(this,"onDropdownOptionCreated",(e,t)=>{e.addEventListener("mousemove",E(i=>t!==this.active?this.setActive(t):null,25))});s(this,"onOptionSelected",e=>{if(e===u){const t=document.createElement("option");t.value=this.searched,t.innerText=this.searched,t.selected=!0,this.select.add(t),e=this.searched}if(e==null&&(e=this.emptyValue),this.multiple){for(const t of this.select.options)if(t.value===e){t.selected=!t.selected;break}}else this.select.value=e;this.select.dispatchEvent(new Event("change")),this.multiple||this.close()});s(this,"setAll",e=>{var t;for(const i of this.select.options){const n=i.value.trim();i.selected=(t=this.dropdownOptions.get(n))!=null&&t.classList.contains("hidden")?i.selected:e}this.select.dispatchEvent(new Event("change"))});s(this,"setActive",e=>{var t,i,n;e!==this.active&&(this.active!==null&&((t=this.dropdownOptions.get(this.active))==null||t.classList.remove("active")),e!==null&&((i=this.dropdownOptions.get(e))==null||i.classList.add("active"),(n=this.dropdownOptions.get(e))==null||n.scrollIntoView({block:"nearest",behavior:"smooth"})),this.active=e)});s(this,"moveActiveDown",()=>{let e=!1;for(const[t,i]of this.dropdownOptions.entries())if(i.isConnected){if(e){this.setActive(t);break}t===this.active&&(e=!0)}});s(this,"moveActiveUp",()=>{let e=null;for(const[t,i]of this.dropdownOptions.entries())if(i.isConnected){if(t===this.active){e&&this.setActive(e);break}e=t}});s(this,"update",()=>{this.multiple?this.updateMultiple():this.updateSingle()});s(this,"updateMultiple",()=>{this.current=this.calcCurrent();const e=[];for(const[t,i]of this.dropdownOptions)this.current.includes(t)?(i.classList.add("selected"),e.push(i.innerText.trim())):i.classList.remove("selected");this.setPreview(e.join(", "))});s(this,"updateSingle",()=>{this.current=this.calcCurrent(),this.dropdown.querySelectorAll(".ss-option.selected").forEach(t=>t.classList.remove("selected"));let e="";if(this.current!==this.emptyValue){const t=this.dropdownOptions.get(this.current);t&&(t.classList.add("selected"),e=t.innerText??"")}this.setPreview(e.trim())});var n,r;this.multiple=t,this.allowCustom=i,this.fetchUrl=e.getAttribute("data-fetchurl"),this.rootEl=e,this.dropdown=e.querySelector(".ss-dropdown"),this.dropdownSearch=this.dropdown.querySelector(".ss-dropdown-search input"),this.dropdownSelectAllBtn=this.dropdown.querySelector(".ss-dropdown-search .ss-select-all"),this.dropdownUnselectAllBtn=this.dropdown.querySelector(".ss-dropdown-search .ss-unselect-all"),this.dropdownOptionsWrapper=this.dropdown.querySelector(".ss-options"),this.template=e.querySelector(".ss-option-template"),this.uiBox=e.querySelector(".ss-box"),this.placeholder=((n=this.uiBox)==null?void 0:n.querySelector(".ss-placeholder"))??null,this.valueLabel=((r=this.uiBox)==null?void 0:r.querySelector(".ss-value-label"))??null,this.select=e.querySelector(".ss-ghost-select"),this.current=this.calcCurrent()}get emptyValue(){return this.multiple?"":this.select.firstElementChild.value}get searched(){var e;return((e=this.dropdownSearch)==null?void 0:e.value)??""}onLivewireUpdate(e){e===this.select&&(JSON.stringify(this.current)!==JSON.stringify(this.calcCurrent())&&this.update(),setTimeout(()=>this.populateDropdown(),50))}setPreview(e){if(this.valueLabel===null||this.placeholder===null){console.error("Should not set preview here without valueLabel");return}e!==""?(this.valueLabel.innerHTML=e,this.valueLabel.style.display="block",this.placeholder.style.display="none"):(this.placeholder.style.display="block",this.valueLabel.style.display="none")}}class O extends f{constructor(e){super(e,!1,!1)}}class g extends f{constructor(e){super(e,!0,!1)}}class A extends f{constructor(t){var i;super(t,!1,t.getAttribute("data-allow-custom")!==null);s(this,"input");s(this,"latestPreview","");s(this,"onOpen",()=>{});s(this,"onClose",()=>{});this.input=t.querySelector(".ac-input"),this.input.addEventListener("input",m(n=>{this.search(),this.fetchOptions()},250)),(i=this.input)==null||i.addEventListener("keydown",n=>{this.isOpen||this.open(),n.key==="Enter"&&n.preventDefault()}),this.input.addEventListener("focus",()=>{this.open(),this.search(),setTimeout(()=>this.input.select(),50)}),this.input.addEventListener("blur",()=>{setTimeout(()=>{this.input.value!==""&&this.input.value!==this.latestPreview&&this.onOptionSelected(this.emptyValue)},250)})}get searched(){var t;return((t=this.input)==null?void 0:t.value)??""}setPreview(t){this.input.value=t.trim(),this.latestPreview=t.trim()}}const S=l=>{l.querySelectorAll("div.ss-wrapper").forEach(e=>new O(e).init()),l.querySelectorAll("div.ms-wrapper").forEach(e=>new g(e).init()),l.querySelectorAll("div.ac-wrapper").forEach(e=>new A(e).init())};S(document);const b=new MutationObserver(function(l){l.forEach(function(e){e.addedNodes.forEach(function(t){t.nodeType===1&&S(t)})})});b.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1});
