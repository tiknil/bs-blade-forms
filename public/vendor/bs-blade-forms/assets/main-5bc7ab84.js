var L=Object.defineProperty;var S=(l,e,t)=>e in l?L(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var i=(l,e,t)=>(S(l,typeof e!="symbol"?e+"":e,t),t);let w=0;const v=(l,e)=>(...t)=>{clearTimeout(w),w=setTimeout(()=>l(...t),e)};let u=null,f=0;const y=(l,e)=>(...t)=>{u===null?(l(...t),u=Date.now()):(clearTimeout(f),f=setTimeout(()=>{Date.now()-u>=e&&(l(...t),u=Date.now())},e-(Date.now()-u)))};class p{constructor(e,t){i(this,"rootEl");i(this,"multiple");i(this,"fetchUrl",null);i(this,"fetchAbortController",null);i(this,"dropdown");i(this,"dropdownOptions",new Map);i(this,"optionsSearchText",new Map);i(this,"dropdownSearch");i(this,"dropdownSelectAllBtn",null);i(this,"dropdownUnselectAllBtn",null);i(this,"uiBox");i(this,"placeholder");i(this,"valueLabel");i(this,"select");i(this,"current");i(this,"active",null);i(this,"isOpen",!1);i(this,"calcCurrent",()=>this.multiple?Array.from(this.select.selectedOptions).map(e=>e.value):this.select.value);i(this,"init",()=>{var e,t,o,s,r;this.populateDropdown(),(e=this.uiBox)==null||e.addEventListener("click",()=>this.toggle()),document.addEventListener("click",n=>{this.rootEl.contains(n.target)||this.close(!1)}),document.addEventListener("keyup",n=>{n.key==="Escape"&&this.close(!1)}),document.addEventListener("keydown",n=>{n.key===" "&&this.uiBox===document.activeElement&&this.toggle(),this.isOpen&&this.active!==null&&n.key==="Enter"&&this.onOptionSelected(this.active),this.isOpen&&this.active!==null&&n.key==="ArrowDown"&&this.moveActiveDown(),this.isOpen&&this.active!==null&&n.key==="ArrowUp"&&this.moveActiveUp()}),(t=this.dropdownSearch)==null||t.addEventListener("input",v(n=>{this.search(),this.fetchOptions()},250)),(o=this.dropdownSearch)==null||o.addEventListener("keydown",n=>{n.key==="Enter"&&n.preventDefault()}),this.dropdown.addEventListener("click",n=>{const h=n.target;if(h.classList.contains("ss-remove-icon")){this.onOptionSelected(this.emptyValue);return}const c=h.closest(".ss-option");c!==null&&this.onOptionSelected(c.getAttribute("data-key"))}),this.select.addEventListener("change",this.update),(s=this.dropdownSelectAllBtn)==null||s.addEventListener("click",n=>this.setAll(!0)),(r=this.dropdownUnselectAllBtn)==null||r.addEventListener("click",n=>this.setAll(!1)),this.update(),this.initLivewire(),this.fetchOptions()});i(this,"initLivewire",()=>{if(!this.rootEl.hasAttribute("data-livewire")){window.Livewire&&console.info("[SearchSelect] Be sure to include the livewire attribute when rendering inside a Livewire component");return}if(!window.Livewire){console.error("MISSING LIVEWIRE GLOBAL OBJECT!");return}window.Livewire.hook("morph.updated",({el:t})=>this.onLivewireUpdate(t)),window.Livewire.hook("element.init",({el:t})=>setTimeout(()=>this.onLivewireUpdate(t),50))});i(this,"open",()=>{this.isOpen=!0,this.dropdown.classList.remove("hidden"),this.setActive(this.dropdownOptions.keys().next().value??null),this.onOpen()});i(this,"onOpen",()=>{setTimeout(()=>{var e;return(e=this.dropdownSearch)==null?void 0:e.focus()},25)});i(this,"close",(e=!0)=>{var t;this.isOpen=!1,this.dropdown.classList.add("hidden"),e&&((t=this.uiBox)==null||t.focus()),this.onClose()});i(this,"onClose",()=>{});i(this,"toggle",()=>{this.isOpen?this.close():this.open()});i(this,"fetchOptions",async()=>{if(!this.fetchUrl)return;this.fetchAbortController&&this.fetchAbortController.abort(),this.fetchAbortController=new AbortController;const e=this.fetchAbortController.signal;let t=new URL(this.fetchUrl,window.location.origin);const o=this.searched.trim();o&&t.searchParams.append("q",o),this.dropdown.classList.add("loading");try{const s=await fetch(t.toString(),{signal:e});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const r=await s.json(),n=this.emptyValue,h=new Map;for(const c of this.select.options)c.value!==n&&c.selected&&h.set(c.value,c.innerText);if(this.select.innerHTML="",!this.multiple){const c=document.createElement("option");c.value=n,this.select.appendChild(c)}for(const c in r){const d=c.toString(),a=document.createElement("option");a.value=d,a.innerText=r[d],h.has(d)&&(a.selected=!0,h.delete(d)),this.select.appendChild(a)}for(const[c,d]of h){const a=document.createElement("option");a.value=c,a.innerText=d,a.selected=!0,a.setAttribute("data-hidden","true"),this.select.appendChild(a)}this.populateDropdown()}catch(s){console.error("[SearchSelect] Error fetching options:",s)}finally{this.dropdown.classList.remove("loading"),this.fetchAbortController=null}});i(this,"search",()=>{var s;if(this.fetchUrl!==null)return;let e=this.searched.toLowerCase().trim();e.length<2&&(e="");let t=null;const o=[];for(const[r,n]of this.dropdownOptions)(e===""||((s=this.optionsSearchText.get(r))==null?void 0:s.includes(e)))&&(o.push(n),t===null&&(t=r));requestAnimationFrame(()=>{const r=this.dropdown.querySelector(".ss-options"),n=document.createDocumentFragment();o.forEach(h=>{n.appendChild(h)}),r.replaceChildren(n),this.setActive(t)})});i(this,"populateDropdown",()=>{const e=new Set(this.dropdownOptions.keys()),t=this.rootEl.querySelector(".ss-option-template"),o=this.dropdown.querySelector(".ss-options");for(const s of this.select.options){if(s.value===this.emptyValue)continue;if(this.dropdownOptions.has(s.value)){e.delete(s.value);const n=this.dropdownOptions.get(s.value);n.querySelector("span").innerText=s.innerText,s.hasAttribute("data-hidden")?n.classList.add("hidden"):n.classList.remove("hidden");continue}const r=t.content.cloneNode(!0).firstElementChild;r.setAttribute("data-key",s.value),r.querySelector("span").innerText=s.label,s.hasAttribute("data-hidden")?r.classList.add("hidden"):r.classList.remove("hidden"),o.appendChild(r),this.onDropdownOptionCreated(r,s.value),this.dropdownOptions.set(s.value,r),this.optionsSearchText.set(s.value,s.label.toLowerCase())}e.forEach(s=>{var r;(r=this.dropdownOptions.get(s))==null||r.remove(),this.dropdownOptions.delete(s),this.optionsSearchText.delete(s)})});i(this,"onDropdownOptionCreated",(e,t)=>{e.addEventListener("mousemove",y(o=>t!==this.active?this.setActive(t):null,25))});i(this,"onOptionSelected",e=>{if(e==null&&(e=this.emptyValue),this.multiple){for(const t of this.select.options)if(t.value===e){t.selected=!t.selected;break}}else this.select.value=e;this.select.dispatchEvent(new Event("change")),this.multiple||this.close()});i(this,"setAll",e=>{var t;for(const o of this.select.options){const s=o.value.trim();o.selected=(t=this.dropdownOptions.get(s))!=null&&t.classList.contains("hidden")?o.selected:e}this.select.dispatchEvent(new Event("change"))});i(this,"setActive",e=>{var t,o,s;e!==this.active&&(this.active!==null&&((t=this.dropdownOptions.get(this.active))==null||t.classList.remove("active")),e!==null&&((o=this.dropdownOptions.get(e))==null||o.classList.add("active"),(s=this.dropdownOptions.get(e))==null||s.scrollIntoView({block:"nearest",behavior:"smooth"})),this.active=e)});i(this,"moveActiveDown",()=>{let e=!1;for(const[t,o]of this.dropdownOptions.entries())if(o.isConnected){if(e){this.setActive(t);break}t===this.active&&(e=!0)}});i(this,"moveActiveUp",()=>{let e=null;for(const t of this.dropdownOptions.keys()){if(t===this.active){e&&this.setActive(e);break}e=t}});i(this,"update",()=>{this.multiple?this.updateMultiple():this.updateSingle()});i(this,"updateMultiple",()=>{this.current=this.calcCurrent();const e=[];for(const[t,o]of this.dropdownOptions)this.current.includes(t)?(o.classList.add("selected"),e.push(o.innerText.trim())):o.classList.remove("selected");this.setPreview(e.join(", "))});i(this,"updateSingle",()=>{this.current=this.calcCurrent(),this.dropdown.querySelectorAll(".ss-option.selected").forEach(t=>t.classList.remove("selected"));let e="";if(this.current!==this.emptyValue){const t=this.dropdownOptions.get(this.current);t&&(t.classList.add("selected"),e=t.innerText??"")}this.setPreview(e.trim())});var o,s;this.multiple=t,this.fetchUrl=e.getAttribute("data-fetchurl"),this.rootEl=e,this.dropdown=e.querySelector(".ss-dropdown"),this.dropdownSearch=this.dropdown.querySelector(".ss-dropdown-search input"),this.dropdownSelectAllBtn=this.dropdown.querySelector(".ss-dropdown-search .ss-select-all"),this.dropdownUnselectAllBtn=this.dropdown.querySelector(".ss-dropdown-search .ss-unselect-all"),this.uiBox=e.querySelector(".ss-box"),this.placeholder=((o=this.uiBox)==null?void 0:o.querySelector(".ss-placeholder"))??null,this.valueLabel=((s=this.uiBox)==null?void 0:s.querySelector(".ss-value-label"))??null,this.select=e.querySelector(".ss-ghost-select"),this.current=this.calcCurrent()}get emptyValue(){return this.multiple?"":this.select.firstElementChild.value}get searched(){var e;return((e=this.dropdownSearch)==null?void 0:e.value)??""}onLivewireUpdate(e){e===this.select&&(JSON.stringify(this.current)!==JSON.stringify(this.calcCurrent())&&this.update(),setTimeout(()=>this.populateDropdown(),50))}setPreview(e){if(this.valueLabel===null||this.placeholder===null){console.error("Should not set preview here without valueLabel");return}e!==""?(this.valueLabel.innerHTML=e,this.valueLabel.style.display="block",this.placeholder.style.display="none"):(this.placeholder.style.display="block",this.valueLabel.style.display="none")}}class O extends p{constructor(e){super(e,!1)}}class E extends p{constructor(e){super(e,!0)}}class A extends p{constructor(t){var o;super(t,!1);i(this,"input");i(this,"latestPreview","");i(this,"onOpen",()=>{});i(this,"onClose",()=>{});this.input=t.querySelector(".ac-input"),this.input.addEventListener("input",v(s=>{this.search(),this.fetchOptions()},250)),(o=this.input)==null||o.addEventListener("keydown",s=>{this.isOpen||this.open(),s.key==="Enter"&&s.preventDefault()}),this.input.addEventListener("focus",()=>{this.open(),this.search(),setTimeout(()=>this.input.select(),50)}),this.input.addEventListener("blur",()=>{setTimeout(()=>{this.input.value!==""&&this.input.value!==this.latestPreview&&this.onOptionSelected(this.emptyValue)},250)})}get searched(){var t;return((t=this.input)==null?void 0:t.value)??""}setPreview(t){this.input.value=t.trim(),this.latestPreview=t.trim()}}const m=l=>{l.querySelectorAll("div.ss-wrapper").forEach(e=>new O(e).init()),l.querySelectorAll("div.ms-wrapper").forEach(e=>new E(e).init()),l.querySelectorAll("div.ac-wrapper").forEach(e=>new A(e).init())};m(document);const b=new MutationObserver(function(l){l.forEach(function(e){e.addedNodes.forEach(function(t){t.nodeType===1&&m(t)})})});b.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1});
